{% extends "sqlshare_web/base.html" %}

{% block title %}SQLSHARE: Dataset Detail{% endblock %}

{% load staticfiles %}

{% block content %}

<h2>{{ dataset.name }}</h2>

<div style="position:relative;">
    
    <span class="sql-dataset-owner">{{ dataset.owner }}</span>
    <span class="sql-dataset-modified">modified on {{ dataset.date_modified }}</span>
    
    <div class="form-group sql-dataset-desc" style="margin: 15px 0;">
        <label for="query_sql" class="sr-only">Description:</label>    
        <textarea class="form-control" id="dataset_description">{{ dataset.description }}</textarea>
    </div>
    
    <div class="sql-dataset-actions">
        <button type="button" class="btn btn-default btn-xs" id="make_dataset_private" {% if not dataset.is_public %}style="display:none;"{% endif %}><i class="fa fa-eye-slash"></i> MAKE PRIVATE</button>
        <button type="button" class="btn btn-default btn-xs" id="make_dataset_public" {% if dataset.is_public %}style="display:none;"{% endif %}><i class="fa fa-eye"></i> MAKE PUBLIC</button>
        <button type="button" class="btn btn-default btn-xs" id=""><i class="fa fa-share"></i> SHARE</button>
        <button type="button" class="btn btn-danger btn-xs" id=""><i class="fa fa-trash"></i> DELETE</button>
    </div>    

</div>
    

<form method="POST" style="margin-top: 3em;">
    {% csrf_token %}

    <div class="form-group">
        <label for="query_sql" class="sr-only">SQL Query:</label>    
        <textarea id="dataset_sql" name='dataset_sql' class="well" style="background:#fff;">{{ dataset.sql_code }}</textarea>
    </div>
    
    <div style="margin-bottom:1em; position: relative;">
        <button type="button" class="btn btn-default" id="run_query">RUN QUERY</button>
        <button type="button" class="btn btn-default" id="update_dataset_sql" style="display: none;">UPDATE DATASET</button>
        <button type="button" class="btn btn-default btn-xs" id="" style="position: absolute; right:0;">START NEW DATASET FROM QUERY</button>
    </div>
  
</form> 

    
<div id="query_preview_panel" style="margin-top:3em; display: none;">
    <h3>Dataset Preview</h3>

    <div id="query_running_panel" style="display: none;"><i class="fa fa-circle-o-notch fa-spin"></i> Running...</div>
    <div id="query_results_panel" style="display: none;"></div>

</div>
    

<div style="position:relative; margin-top:3em;" id="original_results_panel" >
    
    <h3>Dataset Preview</h3>
    
    {% if dataset.sample_data_status == "working" %}
        <p class="text-muted"><i class="fa fa-circle-o-notch fa-spin"></i> Building preview...</p>
    {% endif %}
    
    {% if dataset.sample_data_status == "error" %}
        <p class="text-danger">Error creating preview: {{ dataset.sample_data_error }}</p>
    {% endif %}
    

    {% if dataset.sample_data_status == "success" %}
    <div class="well table-responsive" style="background:#fff; margin: 15px 0;">
    <table class="table table-striped" style="font-size:12px !important;">
        <thead style="font-size:12px !important;">
        <tr role="row">
            {% for col in dataset.columns %}
                <th class="sorting_asc" tabindex="0" rowspan="1" colspan="1" aria-sort="ascending" aria-label="ID: activate to sort column descending" style="width: 42px;">{{ col.name }}</th>
            {% endfor %}
            </tr>
        </thead>
        <tbody role="alert" aria-live="polite" aria-relevant="all" style="font-size:12px !important;">
            {% for row in dataset.sample_data %}
            <tr>
                {% for col in row %}
                    <td>{{ col }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% endif %}

    <div class="sql-dataset-actions">
        <button type="button" class="btn btn-default btn-xs" id=""><i class="fa fa-download"></i> DOWNLOAD</button>
        <button type="button" class="btn btn-default btn-xs" id=""><i class="fa fa-code-fork"></i> DERIVE</button>
        <button type="button" class="btn btn-default btn-xs" id=""><i class="fa fa-camera"></i> SNAPSHOT</button>
        
    </div>

</div>

<script>
    document.body.onload = function() { prep_details_page(); };
</script>

{% endblock %}
